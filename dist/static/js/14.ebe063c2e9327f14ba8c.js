webpackJsonp([14],{"1Rmb":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("6lib"),o=s("9vbe"),a=s("bbS5"),n=(o.default,a.default,{name:"Login",data:function(){return{isActive:!1,mobile:"",code:"",errorMsg:"",times:"获取验证码",timer:null,onOff:null,toastTip:!1,vmiao:!1,agreement1:!1,agreement2:!1,isShow:1}},components:{UserAgreement:o.default,PrivacyAgreement:a.default},computed:{text:function(){return this.times>0?this.times+"s":"获取验证码"}},methods:{agreement1IsShow:function(){this.agreement1=!0,this.isShow=2},agreement1Close:function(){this.agreement1=!1,this.isShow=1},agreement2IsShow:function(){this.agreement2=!0,this.isShow=2},agreement2Close:function(){this.agreement2=!1,this.isShow=1},validState:function(){11==this.mobile.length&&this.code.length>=6?this.isActive=!0:this.isActive=!1},countDown:function(){this.validMobile()&&(this.sendCode(),this.onOff=!0)},validMobile:function(){return!(""==this.mobile||11!=this.mobile.length||!/^1[3|4|5|7|8|9|6]\d{9}$/.test(this.mobile))||(this.tipShow("请输入正确的手机号"),!1)},validCode:function(){return!(""==this.code||this.code.length<6)||(this.tipShow("验证码有误，请重新输入"),!1)},tipShow:function(t){this.errorMsg=t,this.toastTip=!0;var e=this;setTimeout(function(){return e.toastTip=!1,!1},2e3)},sendCode:function(){var t=this;return!!this.validMobile()&&("number"!=typeof this.times&&void this.$http.post(this.baseurl+"/sms/login/code",{mobile:this.mobile}).then(function(e){console.log(e);clearInterval(t.timer),t.times=60,t.vmiao=!0;var s=t;t.timer=setInterval(function(){s.times--,s.times<=0&&(clearInterval(s.timer),s.timer=null,s.vmiao=!1,s.times="重新获取",s.onOff=!0)},1e3)}).catch(function(e){console.log(e),e.response&&(console.log(e.response.data.message),t.tipShow(e.response.data.message),t.onOff=!1)}))},getLoginMsgData:function(){var t=this;this.isActive&&this.validMobile()&&this.validCode()&&this.$http.post(this.baseurl+"/login/code",{mobile:this.mobile,code:this.code}).then(function(e){console.log(e),t.tipShow("登录成功");var s=e.data.data;i.a.setCookie("accountId",s.account_id),i.a.setCookie("mobile",t.mobile),i.a.setCookie("accesstoken",s.access_token),i.a.setCookie("uid",s.nim_id),i.a.setCookie("sdktoken",s.nim_token),"session"==i.a.getStore("tempUrl")?t.getSessionId(s.nim_id,t.mobile,s.account_id):"session"!=i.a.getStore("tempUrl")&&""!=i.a.getStore("tempUrl")&&i.a.getStore("tempUrl")?t.$router.push({path:i.a.getStore("tempUrl")}):t.$router.push({path:"/"})}).catch(function(e){console.log(e),e.response&&(console.log(e.response.data.message),t.tipShow(e.response.data.message),_this.onOff=!1)})},getSessionId:function(t,e,s){var o=this,a={params:{customerIM:t,customerPhone:e}};this.$http.post(this.baseurl+"/im/getimaccount",a).then(function(t){if(200==t.data.code){var e=t.data.data;o.sessionId=i.a.setCookie("sessionId",e),o.getAccountId(s)}})},getAccountId:function(t){var e=this,s={params:{accountId:t}};this.$http.post(this.baseurl+"/im/notice",s).then(function(t){if(200==t.data.code){e.accountMsg=t.data.data;t.data.data.sendTime;i.a.setCookie("sendTime",t.data.data.sendTime);t.data.data.readStatus;i.a.setCookie("readStatus",t.data.data.readStatus);t.data.data.msgDetails;i.a.setCookie("msgDetails",t.data.data.msgDetails),i.a.setCookie("accountMsg",e.accountMsg),window.location.href="http://"+window.location.hostname+"/im.html#/session"}})}},beforeRouteEnter:function(t,e,s){"/login"==e.path||"/register"==e.path||"/messagelogin"==e.path||"/forgetpassword"==e.path?i.a.setStore("tempUrl",i.a.getStore("tempUrl")):"/"==e.path&&"home"!=e.name?i.a.setStore("tempUrl","session"):i.a.setStore("tempUrl",e.fullPath),s()}}),r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{directives:[{name:"show",rawName:"v-show",value:1==t.isShow,expression:"isShow==1"}],staticClass:"login"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.toastTip,expression:"toastTip"}],staticClass:"toast-tip"},[t._v("\n    "+t._s(t.errorMsg)+"\n  ")]),t._v(" "),s("div",{staticClass:"header line-bottom"},[s("span",{staticClass:"icon-back",on:{click:function(e){t.$router.go(-1)}}}),t._v("\n    手机快捷登录\n  ")]),t._v(" "),t._m(0),t._v(" "),s("div",{staticClass:"form-frame"},[s("div",{staticClass:"from-input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.mobile,expression:"mobile"}],staticClass:"input1 tel1",attrs:{type:"tel",placeholder:"手机号",maxlength:"11"},domProps:{value:t.mobile},on:{input:[function(e){e.target.composing||(t.mobile=e.target.value)},t.validState]}}),t._v(" "),t._m(1),t._v(" "),s("span",{staticClass:"getcode",on:{click:t.sendCode}},[t._v(t._s(t.times)),t.vmiao?s("i",[t._v("s")]):t._e()])]),t._v(" "),s("div",{staticClass:"from-input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.code,expression:"code"}],staticClass:"input1 password1",attrs:{type:"text",placeholder:"验证码"},domProps:{value:t.code},on:{input:[function(e){e.target.composing||(t.code=e.target.value)},t.validState]}}),t._v(" "),t._m(2)]),t._v(" "),s("router-link",{staticClass:"messageLoginBtn",attrs:{tag:"div",to:"/login"}},[t._v("账号登录")]),t._v(" "),s("div",{staticClass:"btnLogin",class:{activeState:t.isActive},on:{click:t.getLoginMsgData}},[t._v("登录")]),t._v(" "),s("router-link",{staticClass:"btnRegister",attrs:{tag:"div",to:"/register"}},[t._v("注册")]),t._v(" "),s("div",{staticClass:"agreement"},[t._v("\n      注册/登录即代表同意商机盒子的"),s("a",{attrs:{href:"javascript:void(0)"},on:{click:t.agreement1IsShow}},[t._v("《用户协议》")]),t._v("和"),s("a",{on:{click:t.agreement2IsShow}},[t._v("《隐私协议》")])])],1)]),t._v(" "),s("user-agreement",{attrs:{agreement1:t.agreement1},on:{"child-msg1":t.agreement1Close}}),t._v(" "),s("privacy-agreement",{attrs:{agreement2:t.agreement2},on:{"child-msg2":t.agreement2Close}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"logoImg"},[e("img",{attrs:{src:"/static/images/home/bg_shangjihezilogo@3x.png"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"icon-tel iconImg"},[e("img",{attrs:{src:"/static/images/home/icon/icon_phone@3x.png"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"icon-code iconImg"},[e("img",{attrs:{src:"/static/images/home/icon/icon_acthcode@3x.png"}})])}]};var c=s("VU/8")(n,r,!1,function(t){s("sP4E")},"data-v-ebb34d18",null);e.default=c.exports},sP4E:function(t,e){}});
//# sourceMappingURL=14.ebe063c2e9327f14ba8c.js.map